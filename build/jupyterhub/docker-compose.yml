# JupyterHub docker-compose configuration file
version: '3' # Simplified version

services:
  jupyterhub: # Renamed from 'hub' for clarity
    build: . # Build the hub image from the current directory
    image: jupyterhub-local:latest # Give the built image a local name
    container_name: jupyterhub
    restart: always
    ports:
      - "8000:8000" # Expose HTTP port
    volumes:
      # Mount docker socket to allow Hub to control Docker
      - /var/run/docker.sock:/var/run/docker.sock:rw
      # Persist hub data
      - jupyterhub-data:/data
    environment:
      # Use the playground image we built
      DOCKER_NOTEBOOK_IMAGE: jupyter-playground:latest
      # Define the internal network name
      DOCKER_NETWORK_NAME: jupyterhub_internal_network
      # Other minimal env vars if needed by the config (adjust as needed)
      DATA_VOLUME_CONTAINER: /data # For cookie secret path
    networks:
      - internal_network
    # No command needed here if Dockerfile has CMD/ENTRYPOINT
    # command: jupyterhub -f /srv/jupyterhub/jupyterhub_config.py

volumes:
  jupyterhub-data: # Simple local volume for data

networks:
  internal_network:
    name: jupyterhub_internal_network # Explicitly name the network
    driver: bridge
